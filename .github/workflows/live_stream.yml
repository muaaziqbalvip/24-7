name: MiTV Ultimate Solo Engine

on:
  workflow_dispatch:
    inputs:
      video_link:
        description: 'Video Link'
        required: true
      stream_key:
        description: 'YouTube Stream Key'
        required: true
      patti_text:
        description: 'Patti Text (Symbols Allowed)'
        default: 'MiTV Network - Powered by Muaaz Iqbal'

jobs:
  broadcaster:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg fonts-dejavu

      - name: Start Live Stream
        run: |
          # 1. Patti ka text aik file mein save karna (Special Character Safety)
          echo "${{ github.event.inputs.patti_text }}" > patti.txt
          
          # 2. Variables
          VIDEO="${{ github.event.inputs.video_link }}"
          KEY="${{ github.event.inputs.stream_key }}"
          LOGO="logon.png"

          echo "--- MiTV Station Starting for Muaaz ---"

          # 3. Execution Command (Simplified & Robust)
          ffmpeg -y -re -stream_loop -1 -i "$VIDEO" \
          -filter_complex \
          "[0:v]scale=1280:720[bg]; \
           movie=$LOGO,scale=130:-1[logo_img]; \
           [bg][logo_img]overlay=20:20[v_logo]; \
           [v_logo]drawbox=y=ih-55:x=0:w=iw:h=55:color=blue@0.8:t=fill[p_bg]; \
           [p_bg]drawtext=fontfile=/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf:textfile=patti.txt:reload=1:x=w-mod(t*130\,w+tw):y=ih-40:fontsize=28:fontcolor=white[final_v]" \
          -map "[final_v]" -map 0:a \
          -c:v libx264 -preset veryfast -b:v 3000k -pix_fmt yuv420p \
          -c:a aac -b:a 128k -f flv "rtmp://a.rtmp.youtube.com/live2/$KEY"
